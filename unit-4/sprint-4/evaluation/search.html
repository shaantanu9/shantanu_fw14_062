<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SearchPage</title>
    <script src="https://cdn.tailwindcss.com"></script>

  </head>

  <body>
    <div id="main">
      <!--No need to add sidebar here, directly display search results-->

      <!-- show headline, description and image -->


    </div>
  </body>

<script >

searchquery = window.location.href.split('?')[1]

searchbox(searchquery)

async function searchbox(searchquery){

// let apikey = 'a67fce3d70138121e1059cefe6e02341' //shantnau4
   let apikey = '3e15ad33efae754d7e3030b008978645' // shantanu8


 fetch(`https://gnews.io/api/v4/search?q=${searchquery}&token=${apikey}&country=in&lang=en`)
 .then(function (response) {
     return response.json();
 })
 .then(function (data) {
     console.log(data.articles);
     searchPage(data.articles)
 });

}

function searchPage(articles) {

document.getElementById('main').innerHTML = '';

 //add append logic here
articles.forEach(({image, title,description, content})=>{

qid =  Math.random()*100000000000000000

let articlesStorage = JSON.parse(localStorage.getItem('articles'))

if(articlesStorage==null){
  articlesStorage =[];
}

let obj={
  qid, title, description, content,image
}

articlesStorage.push(obj)

localStorage.setItem('articles', JSON.stringify(articlesStorage))

// console.log(image,title,description)

let single_articleDiv = document.createElement("div")

single_articleDiv.classList.add("rounded","shadow","mx-4","my-4")

let img = document.createElement('img')
img.src = image;
img.classList.add("rounded","w-[400px]")


let titleH3 = document.createElement('h3')
titleH3.innerHTML = title
titleH3.setAttribute('id',qid)
titleH3.classList.add("text-xl","font-bold")

titleH3.setAttribute("onclick", 'fullnews(this.id)' ) 

console.log(titleH3)

let descriptionP = document.createElement('p')
descriptionP.innerHTML = description

single_articleDiv.append(img,titleH3,descriptionP)

document.getElementById('main').append(single_articleDiv)


})    


}

function fullnews(id) {

console.log(id)

window.location.href = `./news.html?${id}`

}

</script>

</html>